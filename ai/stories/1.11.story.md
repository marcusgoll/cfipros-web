# Story 1.11: Enhanced Site Navigation (Header/Footer) with Auth State

**Status:** Draft

**DoD Reference:** All aspects of this story must adhere to the standards outlined in `docs/definition-of-done.md`.

## Goal & Context

**User Story:** As a User, I want to see basic site navigation (header/footer) that changes based on my authentication state, so that I can easily move between key areas of the application.

**Context:** This story builds upon the Landing/Marketing Page (Story 1.10) by enhancing the existing navigation components (TopBar and Footer) to create a consistent, application-wide navigation system that adapts based on user authentication status. While basic versions of these components already exist, they need to be enhanced with authentication-aware functionality and connected to placeholder pages.

## Detailed Requirements

As a User, I want to see enhanced site navigation (header/footer) with the following features:

1. **Enhanced TopBar Navigation**
   - Update navigation links to: "Why CFIPros?", "Products", "Pricing", "Docs", "Community", "Company"
   - Navigation button should change based on authentication state:
     - When not logged in: "Get Started" button (outline variant with primary border color)
     - When logged in: "Dashboard" button (outline variant with primary border color)
   - The active/current page should be visually highlighted
   - TopBar must remain responsive and adapt to mobile screens with a hamburger menu

2. **Enhanced Footer Navigation**
   - Ensure Footer includes copyright information with current year
   - Update/add links to placeholder pages for:
     - Privacy Policy
     - Terms of Service
     - About Us
     - Contact
     - FAQ
   - Footer should remain responsive and maintain readability on mobile devices
   - Footer should maintain consistent styling with the rest of the application

3. **Integration Requirements**
   - Navigation components should be reusable across all application pages
   - Authentication state detection should determine which navigation links and buttons to display
   - Create placeholder pages for all navigation links

## Acceptance Criteria (ACs)

- AC1: TopBar displays updated navigation links: "Why CFIPros?", "Products", "Pricing", "Docs", "Community", "Company".
- AC2: Navigation button changes based on authentication state ("Get Started" when not logged in, "Dashboard" when logged in).
- AC3: Footer includes copyright and links to Privacy Policy/Terms and other placeholder pages.
- AC4: Navigation remains responsive and works well on mobile devices.
- AC5: Active/current page is visually indicated in the navigation.
- AC6: All navigation links correctly route to their respective placeholder pages.
- AC7: Navigation components are reusable across the application.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Refer to the linked `docs/` files for broader context if needed. **All implementation details must align with `docs/definition-of-done.md` criteria.**

- **Relevant Files:**
  - Files to Modify:
    - `src/components/layout/TopBar.tsx` (Update navigation links and add auth-based button logic)
    - `src/components/layout/Footer.tsx` (Update footer links if needed)
    - `src/app/layout.tsx` (Ensure the Header and Footer are applied to all pages)
  - Files to Create:
    - `src/components/layout/NavLink.tsx` (Reusable nav link component with active state)
    - `src/app/(placeholder)/why/page.tsx` (Why CFIPros? placeholder page)
    - `src/app/(placeholder)/products/page.tsx` (Products placeholder page)
    - `src/app/(placeholder)/pricing/page.tsx` (Pricing placeholder page)
    - `src/app/(placeholder)/docs/page.tsx` (Docs placeholder page)
    - `src/app/(placeholder)/community/page.tsx` (Community placeholder page)
    - `src/app/(placeholder)/company/page.tsx` (Company placeholder page)
    - `src/app/(placeholder)/privacy-policy/page.tsx` (Privacy Policy placeholder page)
    - `src/app/(placeholder)/terms/page.tsx` (Terms of Service placeholder page)
    - `src/app/(placeholder)/about/page.tsx` (About Us placeholder page)
    - `src/app/(placeholder)/contact/page.tsx` (Contact placeholder page)
    - `src/app/(placeholder)/faq/page.tsx` (FAQ placeholder page)
  - _(Hint: See `docs/project-structure.md` for overall layout)_

- **Key Technologies:**
  - Next.js (for routing and layout structure)
  - React (functional components)
  - TypeScript (for type safety)
  - Tailwind CSS (for styling)
  - shadcn/ui components (for UI elements like dropdowns, buttons)
  - React Server Components (for static content)
  - Next.js App Router (for handling routes)
  - usePathname hook (for detecting current route)
  - Supabase Auth (for authentication state)
  - PostHog (for analytics tracking)
  - _(Hint: See `docs/tech-stack.md` for full list)_

- **Authentication Integration:**
  - Use Supabase Auth Helper library to detect authentication state
  - Leverage `createClientComponentClient` from Supabase to get user session in client components
  - Modify the TopBar to conditionally render buttons based on auth state
  - _(Hint: See `docs/api-reference.md` for details on Supabase Auth integration)_

- **UI/UX Notes:**
  - Keep the same design language as the existing TopBar and Footer
  - Use outline variant with primary border color for both button states
  - Navigation should clearly indicate the current page
  - Ensure smooth transitions for dropdown/mobile menus
  - Follow accessibility best practices for navigation elements
  - _(Hint: See `docs/ui-ux-spec.md` for design details)_

- **Data Structures:**
  - Consider updating or creating a configuration-based approach for navigation links:
  ```typescript
  interface NavLink {
    title: string;
    href: string;
    requireAuth?: boolean;
    excludeWhenAuth?: boolean;
    roles?: ('student' | 'cfi' | 'school')[];
  }

  const NAV_LINKS: NavLink[] = [
    { title: 'Why CFIPros?', href: '/why' },
    { title: 'Products', href: '/products' },
    { title: 'Pricing', href: '/pricing' },
    { title: 'Docs', href: '/docs' },
    { title: 'Community', href: '/community' },
    { title: 'Company', href: '/company' },
    // More links...
  ];
  ```

- **Environment Variables:**
  - No specific environment variables needed for this story
  - Authentication will use existing Supabase configuration

- **Coding Standards Notes:**
  - Follow component organization standards (layout components in appropriate directory)
  - Use descriptive naming for components and functions
  - Implement proper typing for all props and state
  - Ensure code is well-commented, especially for complex logic
  - Use semantic HTML elements (nav, header, footer, etc.)
  - Ensure all navigation is keyboard accessible
  - Use aria attributes appropriately for accessibility
  - Implement responsive design using Tailwind's responsive classes
  - Continue using PostHog for navigation analytics tracking
  - _(Hint: See `docs/coding-standards.md` for full standards)_

## Tasks / Subtasks

- [ ] **Task 1: Update TopBar Component**
  - [ ] Update navigation links in `src/components/layout/TopBar.tsx` to match the new requirements
  - [ ] Add "Company" link to the navigation menu
  - [ ] Add authentication state detection using Supabase Auth
  - [ ] Conditionally render "Dashboard" button when logged in or "Get Started" button when not logged in
  - [ ] Ensure button styling is outline variant with primary border color
  - [ ] Maintain PostHog tracking for navigation clicks
  - [ ] Add active state indication for current page

- [ ] **Task 2: Create NavLink Component for Active State**
  - [ ] Create `src/components/layout/NavLink.tsx` for reusable navigation links
  - [ ] Implement active state detection using Next.js's usePathname
  - [ ] Style active and inactive states appropriately
  - [ ] Replace the existing Link components in TopBar with NavLink

- [ ] **Task 3: Update Footer Component**
  - [ ] Verify or update copyright information with current year
  - [ ] Ensure links to all placeholder pages are included
  - [ ] Update styling if needed to match application design language

- [ ] **Task 4: Create Placeholder Pages**
  - [ ] Create basic placeholder pages for all navigation links:
    - [ ] Why CFIPros? page
    - [ ] Products page
    - [ ] Pricing page
    - [ ] Docs page
    - [ ] Community page
    - [ ] Company page
    - [ ] Privacy Policy page
    - [ ] Terms of Service page
    - [ ] About Us page
    - [ ] Contact page
    - [ ] FAQ page
  - [ ] Ensure consistent styling across all placeholder pages
  - [ ] Add minimal content indicating these are placeholder pages

- [ ] **Task 5: Verify Navigation in Main Layout**
  - [ ] Check that TopBar and Footer appear correctly on all pages
  - [ ] Test that placeholder pages are accessible via navigation
  - [ ] Verify that auth-specific button logic works correctly

- [ ] **Task 6: Testing and Refinement**
  - [ ] Test navigation on various screen sizes
  - [ ] Verify that auth state detection works correctly
  - [ ] Check that all links route to the correct pages
  - [ ] Ensure keyboard navigation works properly
  - [ ] Test with screen readers for accessibility
  - [ ] Verify PostHog tracking works for new links

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. **All testing must satisfy the criteria in `docs/definition-of-done.md` (section 3.3) and align with `docs/testing-strategy.md`.**

- **Unit Tests:**
  - Test that TopBar component renders with all necessary elements
  - Test that Footer component renders correctly
  - Test that NavLink correctly identifies active state
  - Test conditional rendering based on auth state (both logged-in and logged-out states)
  - Verify that proper buttons appear based on auth state

- **Integration Tests:**
  - Test navigation components within the main layout
  - Verify that auth state detection properly affects button display
  - Ensure routing works correctly between placeholder pages
  - Test that PostHog tracking events fire correctly

- **Manual/CLI Verification:**
  - Visual inspection on different device sizes (mobile, tablet, desktop)
  - Verify that all navigation links go to the expected placeholder pages
  - Check that authentication state changes the button appropriately
  - Test keyboard navigation throughout the site
  - Verify that the active page is clearly indicated

- **Automated Verification:**
  - Run accessibility tests using tools like Lighthouse
  - Verify responsive behavior with automated viewport testing
  - Test keyboard navigation with automated accessibility tools

## DoD Checklist (Story Specific Points)

- [ ] **Requirements & ACs:** All criteria in DoD section 3.1 met.
- [ ] **Design & Implementation:** All criteria in DoD section 3.2 met.
- [ ] **Testing & Verification:** All criteria in DoD section 3.3 met.
- [ ] **Documentation & Handover:** All criteria in DoD section 3.4 met.
- [ ] **Story Management:** All criteria in DoD section 3.5 met.
- _(Note: This is a reminder; detailed checks are in `docs/definition-of-done.md`)_ 