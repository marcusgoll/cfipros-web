# Story 1.4: User Sign Up for Student Account

**Status:** Draft

## Goal & Context

**User Story:** As a User, I want to be able to sign up for a new Student account (free), so that I can access the platform.

**Context:** This story builds upon the implementation of the database schema for Users in Supabase (Story 1.3). With the database schema now in place, we can implement the sign-up functionality for Students, which is the first of three user roles (Student, CFI, School Admin) we'll be supporting. This story specifically focuses on the Student account registration process, including form creation, validation, submission to Supabase, and email verification flow.

## Detailed Requirements

Copied from `docs/epic1.md` (E1-S4):
As a User, I want to be able to sign up for a new Student account (free), so that I can access the platform.

## Acceptance Criteria (ACs)

Copied from `docs/epic1.md` (E1-S4):

- AC1: Signup form available with fields for Full Name, Email, Password, Confirm Password.
- AC2: Successful submission creates a new user record in Supabase with 'Student' role.
- AC3: Email verification sent to the user (using Resend).
- AC4: User cannot log in until email is verified.
- AC5: Appropriate error handling for existing email, password mismatch, etc.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Refer to the linked `docs/` files for broader context if needed.

- **Relevant Files:**

  - Files to Create:
    - `src/components/features/auth/SignUpForm.tsx` (The signup form component)
    - `src/components/features/auth/VerifyEmail.tsx` (Email verification component)
    - `src/app/sign-up/page.tsx` (Sign-up page)
    - `src/app/verify-email/page.tsx` (Email verification page)
  - Files to Modify:
    - `src/lib/supabase/auth.ts` (To add signup functionality)
    - `src/services/email.ts` (To integrate email verification using Resend)
  - _(Hint: See `docs/project-structure.md` for overall layout)_

- **Key Technologies:**

  - Next.js
  - React
  - TypeScript
  - Supabase Auth
  - Resend (for email)
  - Zod (for form validation)
  - React Hook Form
  - shadcn/ui components
  - _(Hint: See `docs/tech-stack.md` for full list and version information)_

- **API Interactions / SDK Usage:**

  - Use Supabase Auth API for user registration: `supabase.auth.signUp()`
  - Configure Supabase to send verification emails
  - Use Resend API to send custom email templates for verification
  - Implement verification link handling with Supabase URL parameters
  - _(Hint: See `docs/api-reference.md` for details on external APIs and SDKs)_

- **Data Structures:**

  - **SignUpFormData**:
    - `fullName`: string
    - `email`: string
    - `password`: string
    - `confirmPassword`: string
  
  - **User Record**:
    - Uses Supabase `auth.users` table for authentication
    - Creates corresponding record in `profiles` table with role set to 'STUDENT'
  
  - _(Hint: See `docs/data-models.md` for complete data structure details)_

- **Environment Variables:**
  - `NEXT_PUBLIC_SUPABASE_URL`: Supabase project URL
  - `NEXT_PUBLIC_SUPABASE_ANON_KEY`: Supabase anonymous key
  - `RESEND_API_KEY`: API key for Resend email service
  - _(Hint: See `docs/environment-vars.md` for all variables)_

- **Coding Standards Notes:**
  - Use React Hook Form with Zod for form validation
  - Implement proper error handling and user feedback
  - Follow the established component structure for forms
  - Use shadcn/ui components for consistent styling
  - Implement responsive design for mobile compatibility
  - _(Hint: See `docs/coding-standards.md` for full standards)_

## Tasks / Subtasks

- [ ] **Task 1: Create Sign-Up Form Component**
  - [ ] Create `SignUpForm.tsx` component with fields for Full Name, Email, Password, Confirm Password
  - [ ] Implement form validation using Zod and React Hook Form
  - [ ] Add error handling for form validation (client-side)
  - [ ] Style the form using shadcn/ui components
  - [ ] Implement responsive design for mobile compatibility

- [ ] **Task 2: Create Sign-Up Page**
  - [ ] Create `sign-up/page.tsx` to host the SignUpForm component
  - [ ] Add appropriate layout and styling for the page
  - [ ] Include navigation links to login page
  - [ ] Add page metadata (title, description) for SEO

- [ ] **Task 3: Implement Supabase Auth Integration**
  - [ ] Add signup functionality to `supabase/auth.ts`
  - [ ] Configure Supabase to handle email verification
  - [ ] Implement error handling for Supabase API responses
  - [ ] Create user profile with 'STUDENT' role on successful signup

- [ ] **Task 4: Implement Email Verification Flow**
  - [ ] Create email verification template
  - [ ] Integrate Resend API for sending verification emails
  - [ ] Create `verify-email/page.tsx` to handle verification links
  - [ ] Implement VerifyEmail component with success/error states
  - [ ] Redirect user to login page after successful verification

- [ ] **Task 5: Testing**
  - [ ] Test user registration with valid data
  - [ ] Test validation errors (password mismatch, invalid email, etc.)
  - [ ] Test email verification flow
  - [ ] Test error handling for existing email addresses
  - [ ] Verify database records are created correctly

## Testing Requirements

- Test the sign-up form with valid and invalid inputs
- Verify that validation errors are displayed appropriately
- Check that users with existing email addresses cannot register again
- Ensure verification emails are sent and contain valid verification links
- Confirm that unverified users cannot log in
- Verify that users are redirected appropriately after verification
- Test the responsive design on different screen sizes 