# Story 1.4: User Sign Up for Student Account

**Status:** Done

## Implemented Flow Summary

- User signs up with full name, email, and password.
- User receives a verification email and verifies their email address.
- After verification, user logs in with their email and password.
- On first login, if the user's profile does not exist, they are prompted to set their full name (profile setup).
- After setting their profile name, the user is redirected to the dashboard.

## Tasks / Subtasks

- [x] **Task 1: Create Sign-Up Form Component**

  - [x] Create `SignUpForm.tsx` component with fields for Full Name, Email, Password, Confirm Password
  - [x] Implement form validation using Zod and React Hook Form
  - [x] Add error handling for form validation (client-side)
  - [x] Style the form using shadcn/ui components

- [x] **Task 2: Create Sign-Up Page**

  - [x] Create `sign-up/page.tsx` to host the SignUpForm component
  - [x] Add appropriate layout and styling for the page
  - [x] Include navigation links to login page
  - [x] Add page metadata (title, description) for SEO

- [x] **Task 3: Implement Supabase Auth Integration**

  - [x] Add signup functionality to `supabase/auth.ts` (no profile creation at this step)
  - [x] Configure Supabase to handle email verification
  - [x] Implement error handling for Supabase API responses

- [x] **Task 4: Implement Email Verification Flow**

  - [x] Create email verification page and component
  - [x] Handle verification link and call Supabase to verify
  - [x] Redirect user to login page after successful verification

- [x] **Task 5: Implement Login Page**

  - [x] Create `login/page.tsx` with email and password fields
  - [x] Handle login errors and redirect to dashboard on success

- [x] **Task 6: Profile Setup After Login**

  - [x] On first login, check if profile exists
  - [x] If not, prompt user to set full name (`profile-setup/page.tsx`)
  - [x] Create profile in Supabase with role 'STUDENT'
  - [x] Redirect to dashboard after profile setup

- [x] **Task 7: Dashboard Access**
  - [x] Redirect to `/profile-setup` if profile does not exist
  - [x] Show dashboard if profile exists

## Acceptance Criteria

- User can sign up with full name, email, and password
- User receives and verifies email
- User cannot log in until email is verified
- User can log in after verification
- User is prompted to set full name if profile does not exist
- User is redirected to dashboard after profile setup
- Appropriate error handling for all steps

## Detailed Requirements

Copied from `docs/epic1.md` (E1-S4):
As a User, I want to be able to sign up for a new Student account (free), so that I can access the platform.

## Acceptance Criteria (ACs)

Copied from `docs/epic1.md` (E1-S4):

- AC1: Signup form available with fields for Full Name, Email, Password, Confirm Password.
- AC2: Successful submission creates a new user record in Supabase with 'Student' role.
- AC3: Email verification sent to the user (using Resend).
- AC4: User cannot log in until email is verified.
- AC5: Appropriate error handling for existing email, password mismatch, etc.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Refer to the linked `docs/` files for broader context if needed.

- **Relevant Files:**

  - Files to Create:
    - `src/components/features/auth/SignUpForm.tsx` (The signup form component)
    - `src/components/features/auth/VerifyEmail.tsx` (Email verification component)
    - `src/app/sign-up/page.tsx` (Sign-up page)
    - `src/app/verify-email/page.tsx` (Email verification page)
  - Files to Modify:
    - `src/lib/supabase/auth.ts` (To add signup functionality)
    - `src/services/email.ts` (To integrate email verification using Resend)
  - _(Hint: See `docs/project-structure.md` for overall layout)_

- **Key Technologies:**

  - Next.js
  - React
  - TypeScript
  - Supabase Auth
  - Resend (for email)
  - Zod (for form validation)
  - React Hook Form
  - shadcn/ui components
  - _(Hint: See `docs/tech-stack.md` for full list and version information)_

- **API Interactions / SDK Usage:**

  - Use Supabase Auth API for user registration: `supabase.auth.signUp()`
  - Configure Supabase to send verification emails
  - Use Resend API to send custom email templates for verification
  - Implement verification link handling with Supabase URL parameters
  - _(Hint: See `docs/api-reference.md` for details on external APIs and SDKs)_

- **Data Structures:**

  - **SignUpFormData**:
    - `fullName`: string
    - `email`: string
    - `password`: string
    - `confirmPassword`: string
  - **User Record**:
    - Uses Supabase `auth.users` table for authentication
    - Creates corresponding record in `profiles` table with role set to 'STUDENT'
  - _(Hint: See `docs/data-models.md` for complete data structure details)_

- **Environment Variables:**

  - `NEXT_PUBLIC_SUPABASE_URL`: Supabase project URL
  - `NEXT_PUBLIC_SUPABASE_ANON_KEY`: Supabase anonymous key
  - `RESEND_API_KEY`: API key for Resend email service
  - _(Hint: See `docs/environment-vars.md` for all variables)_

- **Coding Standards Notes:**
  - Use React Hook Form with Zod for form validation
  - Implement proper error handling and user feedback
  - Follow the established component structure for forms
  - Use shadcn/ui components for consistent styling
  - Implement responsive design for mobile compatibility
  - _(Hint: See `docs/coding-standards.md` for full standards)_

## Testing Requirements

- Test the sign-up form with valid and invalid inputs
- Verify that validation errors are displayed appropriately
- Check that users with existing email addresses cannot register again
- Ensure verification emails are sent and contain valid verification links
- Confirm that unverified users cannot log in
- Verify that users are redirected appropriately after verification
- Test the responsive design on different screen sizes
