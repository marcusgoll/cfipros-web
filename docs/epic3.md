# Epic 3: Student-CFI/School Linking & Basic Student Management

**Epic Number:** 3
**Title:** Student-CFI/School Linking & Basic Student Management
**Status:** To Do
**Priority:** High
**Product Owner:** TBD
**Assigned Team:** TBD
**Sprint Allocation:** Sprint 4-5 (Estimate)

**Goal:** Implement mechanisms for students to share reports with CFIs (triggering invitations to join CFIPros) and for subscribed CFIs/Flight Schools to invite, link with, and manage a basic list of their students, enabling collaborative data sharing and oversight.

**Description:**
This epic enables the collaborative aspect of CFIPros. Students will be able to send their processed FAA Knowledge Test reports to their CFIs via email. If the CFI isn't a CFIPros user, this email acts as an invitation, fostering viral growth. Subscribed CFIs and Flight School administrators will gain the ability to invite their existing students to the platform or add new ones, link their accounts, and view a list of their students along with their respective test reports. This provides CFIs/Schools with essential oversight of student progress as identified through the knowledge tests.

**User Stories:**

| Story ID | User Story                                                                                                                                                                      | Acceptance Criteria                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Priority | Estimate | Status | Dependencies          | Notes                                                                                                                                                                                                                                                                                                                                                                                                                             |
| :------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------- | :------- | :----- | :-------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| E3-S1    | As a Student, I want to be able to email my processed FAA Knowledge Test report (PDF) to my CFI, so that my CFI can review my performance.                                      | - On the test result page (from Epic 2), an option "Email to CFI" is available.\<br\>- Student enters CFI's email address.\<br\>- Backend generates/retrieves the PDF report and sends it as an attachment via Resend to the CFI's email.\<br\>- Email content is professional and clearly indicates it's from the student via CFIPros.                                                                                                                                                                           | High     | 3 SP     | To Do  | E2 (Report PDF)       |                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| E3-S2    | As a Developer, I want the "Email report to CFI" feature to include an invitation to CFIPros if the CFI is not an existing user, so that it encourages viral adoption.          | - Before sending the email (E3-S1), check if the CFI's email exists as a 'CFI' or 'SchoolAdmin' user in the system.\<br\>- If CFI does not exist, the email content includes a tailored invitation to sign up for CFIPros to view more detailed analytics and manage students, with a unique signup link/token if needed for tracking.\<br\>- If CFI exists, email content is slightly different, perhaps with a direct link to view the student's report if already linked or a prompt to connect.               | High     | 2 SP     | To Do  | E3-S1, E1             | Careful consideration of the user experience for the invited CFI.                                                                                                                                                                                                                                                                                                                                                                 |
| E3-S3    | As a CFI/School Admin (subscribed), I want to be able to invite my existing students to join CFIPros and link their accounts, so I can see their test results.                  | - A section in the CFI/School dashboard to "Invite Student".\<br\>- CFI/Admin enters student's email.\<br\>- Student receives an invitation email with a link to sign up (if new) or confirm linkage (if existing student user).\<br\>- Upon student confirmation, the student is added to the CFI/School's roster.                                                                                                                                                                                               | High     | 3 SP     | To Do  | E1, E1-S16            | Requires subscription check (E1-S16). Full subscription management in E4.                                                                                                                                                                                                                                                                                                                                                         |
| E3-S4    | As a CFI/School Admin (subscribed), I want to be able to add a new student (placeholder or direct creation if student not on platform yet), so I can track them from the start. | - Option to "Add New Student" in CFI/School dashboard.\<br\>- CFI/Admin can input student's name and email.\<br\>- This might create a placeholder record for the student, or send an invitation for them to create their full account and link.\<br\>- The student appears on the CFI/School's roster.                                                                                                                                                                                                           | Medium   | 2 SP     | To Do  | E1, E1-S16            | Placeholder vs. invitation needs UX definition. Subscription check (E1-S16).                                                                                                                                                                                                                                                                                                                                                      |
| E3-S5    | As a CFI/School Admin (subscribed), I want to see a list of all my linked students on a "Student List" page, so I can easily manage my roster.                                  | - A dedicated "Students" or "Roster" page for CFIs/Schools.\<br\>- Displays a table/list of all students linked to the CFI/School account.\<br\>- Shows key student info (Name, Email, perhaps number of reports or last activity).\<br\>- Option to click on a student to view their details (E3-S6).\<br\>- Basic search/filter for the student list.                                                                                                                                                           | High     | 3 SP     | To Do  | E3-S3 / E3-S4, E1-S16 | Subscription check (E1-S16).                                                                                                                                                                                                                                                                                                                                                                                                      |
| E3-S6    | As a CFI/School Admin (subscribed), I want to view a "Student Details" page for each linked student, so I can see all their processed test reports and summaries.               | - Clicking a student from the roster (E3-S5) navigates to their detail page.\<br\>- Displays student's name and contact info.\<br\>- Lists all FAA Knowledge Test reports processed for/by that student and shared with/visible to the CFI/School.\<br\>- Allows CFI/School to view each detailed report (similar to E2-S5 UI) and download the PDF.\<br\>- May show basic summary statistics for that student across their tests.                                                                                | High     | 3 SP     | To Do  | E3-S5, E2, E1-S16     | This page reuses components/views from Epic 2. Subscription check (E1-S16).                                                                                                                                                                                                                                                                                                                                                       |
| E3-S7    | As a Developer, I need to implement the database schema and relationships for Student-CFI/School linking, so that data access is correctly managed.                             | - `student_cfi_links` table (or similar) to store relationships: `student_user_id`, `cfi_user_id` (or `school_id`), `status` (pending, active), `linked_at`.\<br\>- RLS policies to ensure CFIs/Schools can only access data of students explicitly linked to them.\<br\>- Students can potentially link to multiple CFIs/Schools, or one-to-many (student to one CFI/School) - TBD, MVP assume one active link for simplicity or allow multiple. Assume many-to-many or student can link to one CFI, one school. | Critical | 3 SP     | To Do  | E1-S3                 | Decision: For MVP, a student can be linked to one CFI _and_ one School independently, or a CFI is part of a school. Simpler: Student links to a CFI, CFI can be part of a School. Let's aim for Student-CFI link, and School-CFI link. Student data seen by CFI and by School if CFI is part of it. Or, direct Student-School link. For MVP, Student -\> CFI is primary. School -\> CFI. School then sees students of their CFIs. |
| E3-S8    | As a Student, I want to be able_to see which CFIs/Schools I am linked with and potentially manage these links (e.g., unlink).                                                   | - Section in Student's profile/dashboard showing current CFI/School links.\<br\>- Option to "Unlink" from a CFI/School (sends notification to CFI/School).\<br\>- UX for accepting/declining link invitations from CFIs/Schools.                                                                                                                                                                                                                                                                                  | Medium   | 2 SP     | To Do  | E3-S7                 | "Unlink" might be complex with data ownership/visibility rules. MVP: focus on linking. Unlinking might be v1.1.                                                                                                                                                                                                                                                                                                                   |

**Out of Scope for this Epic:**

- Complex role management within a Flight School (e.g., multiple admins, chief instructor roles).
- Direct messaging or communication tools between students and CFIs beyond report sharing.
- Student progress tracking beyond FAA knowledge test results.
- Billing or payment sharing between CFIs and Schools.

**Assumptions:**

- Subscribed CFIs/Schools are the ones who get student management features.
- Students must consent to linking their accounts with CFIs/Schools.
- Email is a reliable method for invitations and notifications.

**Risks:**

- Complexity in managing data visibility and permissions across linked accounts correctly.
- User confusion regarding the linking process or data sharing implications.
- Scope creep if "management" features become too broad for MVP.

**Dependencies:**

- Completed User Authentication (Epic 1).
- Completed Basic Subscription Setup (Epic 1 - E1-S16).
- Completed FAA Knowledge Test Extraction & Basic Reporting (Epic 2) - for report sharing.
- Full Subscription Management (Epic 4) - for full lifecycle management beyond basic status.
- UI/UX designs for student list, detail pages, and invitation flows.

**Metrics for Success:**

- High success rate for students sharing reports with CFIs.
- Significant number of CFIs joining through student invitations.
- CFIs/Schools successfully link with and view their students' data.
- Positive user feedback on the ease of collaboration.
