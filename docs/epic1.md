# Epic 1: Core Platform Setup & User Management

**Epic Number:** 1
**Title:** Core Platform Setup & User Management
**Status:** In Progress
**Priority:** Critical
**Product Owner:** TBD
**Assigned Team:** TBD
**Sprint Allocation:** Sprint 1-2 (Estimate)

**Goal:** Establish the foundational application infrastructure, including database schema, user authentication, onboarding flow for different roles (Student, CFI, School Admin), basic profile management, and landing page, enabling users to register and manage their accounts.

**Description:**
This epic covers all foundational work to get the CFIPros application off the ground. It includes setting up the Next.js project, integrating with Supabase for backend services (database and authentication), defining the core data models for users, and implementing the complete user registration, login, and basic profile management functionalities for all three user roles (Student, CFI, Flight School Administrator). It also includes creating the initial marketing/landing page to attract users and setting up email services for account-related communications.

**User Stories:**

| Story ID | User Story                                                                                                                                                                                           | Acceptance Criteria                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Priority | Estimate | Status | Dependencies | Notes                                                                                |
| :------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------- | :------- | :----- | :----------- | :----------------------------------------------------------------------------------- |
| E1-S1    | As a Developer, I want to set up the Next.js project with TypeScript and ESLint/Prettier configured, so that we have a clean codebase.                                                               | - Next.js project initialized.\<br\>- TypeScript configured and working.\<br\>- ESLint and Prettier configured and integrated into pre-commit hooks.\<br\>- Basic project structure (folders for components, pages, services, etc.) created.                                                                                                                                                                                                                                                                                                       | Critical | 2 SP     | Done   |              |                                                                                      |
| E1-S2    | As a Developer, I want to integrate Supabase into the Next.js project, so that we can use it for database and authentication.                                                                        | - Supabase client libraries installed and configured.\<br\>- Environment variables for Supabase URL and anon key set up securely.\<br\>- Successful connection to Supabase instance established from local dev environment.\<br\>- Basic test query to Supabase works.                                                                                                                                                                                                                                                                             | Critical | 2 SP     | Done   | E1-S1        |                                                                                      |
| E1-S3    | As a Developer, I want to define and implement the initial database schema for Users in Supabase, so that user data can be stored.                                                                   | - `users` table created in Supabase with fields for `id`, `email`, `encrypted_password`, `full_name`, `role` (null by default), `created_at`, `updated_at`.\<br\>- `profiles` table (or similar) linked to `users` for additional profile info if needed.\<br\>- Appropriate RLS policies set up for basic user data access (users can read their own data).\<br\>- School table for School Admin data when needed.                                                                                                                                | Critical | 3 SP     | Done   | E1-S2        | Consider if `organizations` table is needed for Flight Schools.                      |
| E1-S4    | As a User, I want a streamlined signup and authentication process, so that I can create an account easily regardless of my intended role.                                                            | - Single unified signup form with fields for Email, Password, Confirm Password.\<br\>- Successful submission creates a new user record in Supabase with no role assigned initially.\<br\>- Email verification sent to the user via Supabase Auth.\<br\>- User cannot access full platform features until email is verified.\<br\>- Appropriate error handling for existing email, password mismatch, etc.\<br\>- Upon email verification, user is directed to the onboarding flow.                                                                 | High     | 4 SP     | Done   | E1-S3        | Role selection will happen in the onboarding process, not during initial signup.     |
| E1-S5    | As a User, I want a guided onboarding flow after signup, so I can select my role and provide relevant information.                                                                                   | - Onboarding form with role selection (Student, CFI, or School Admin).\<br\>- Different information fields based on selected role: <br> &nbsp;&nbsp;• Students: Full Name only<br> &nbsp;&nbsp;• CFIs: Full Name, Certification Number<br> &nbsp;&nbsp;• School Admins: Full Name, School Name, Part 61/141 Type<br>\- Successful submission updates user profile with role and additional fields.\<br\>- For CFIs and School Admins, redirect to subscription guidance page after profile completion.\<br\>- For Students, redirect to dashboard. | High     | 4 SP     | Done   | E1-S4        | This story consolidates role-specific profile setup into one story.                  |
| E1-S6    | As a CFI or School Admin, I want to see clear guidance about subscription options after onboarding, so I understand how to unlock premium features.                                                  | - Subscription guidance page showing benefits of subscription.\<br\>- Different content for CFIs vs School Admins.\<br\>- Clear call-to-action buttons for subscription options.\<br\>- Option to skip for now and continue with limited features.\<br\>- Link to full subscription page (to be implemented in Epic 4).                                                                                                                                                                                                                            | Medium   | 2 SP     | To Do  | E1-S5        | This prepares users for the subscription flow in Epic 4.                             |
| E1-S7    | As a User, I want to be able to log in to my CFIPros account, so that I can access my dashboard and features.                                                                                        | - Login form available with Email and Password fields.\<br\>- Successful authentication redirects user to their respective dashboard.\<br\>- Secure session management implemented (e.g., using Supabase Auth).\<br\>- "Forgot Password" link available (functionality in a later story if complex).\<br\>- Appropriate error handling for invalid credentials, unverified email, etc.                                                                                                                                                             | Critical | 3 SP     | Done   | E1-S3        |                                                                                      |
| E1-S8    | As a Developer, I want to configure Supabase Auth for email management and Resend for non-auth communications, so users receive appropriate emails.                                                  | - Supabase Auth configured for handling signup, verification, password reset emails.\<br\>- Email templates customized in Supabase Auth.\<br\>- Resend SDK/API integrated (but not used for auth flows).\<br\>- API keys configured securely.\<br\>- Function created for future notification emails via Resend.                                                                                                                                                                                                                                   | High     | 2 SP     | Done   | E1-S2        | Supabase Auth handles all authentication emails; Resend reserved for later use.      |
| E1-S9    | As a logged-in User, I want to be able to view and update my basic profile information, so that my account details are accurate.                                                                     | - Profile page accessible to logged-in users.\<br\>- Displays current Full Name and Email (email possibly read-only or with re-verification).\<br\>- Allows user to update Full Name.\<br\>- Allows user to change their password (current password + new password + confirm new password).\<br\>- Changes are saved to Supabase.                                                                                                                                                                                                                  | Medium   | 3 SP     | Done   | E1-S7        |                                                                                      |
| E1-S10   | As a Visitor, I want to see a compelling Landing/Marketing page, so that I understand what CFIPros offers and can sign up.                                                                           | - Static page(s) developed using Next.js.\<br\>- Content outlines key features and benefits for Students, CFIs, and Schools.\<br\>- Clear Call-to-Actions (CTAs) for signup for each role.\<br\>- Professionally designed, adhering to UI/UX guidelines (calm UX, modern).\<br\>- Page is responsive.                                                                                                                                                                                                                                              | High     | 3 SP     | Done   |              | Design details from UI/UX Spec.                                                      |
| E1-S11   | As a User, I want to see basic site navigation (header/footer), so that I can easily move between key areas of the application.                                                                      | - Header displays logo and navigation links.\<br\>- Navigation links change based on authentication state (e.g., Login/Signup vs. Dashboard/Profile/Logout).\<br\>- Footer includes copyright and links to Privacy Policy/Terms (placeholder pages for now).\<br\>- Navigation is responsive.                                                                                                                                                                                                                                                      | Medium   | 2 SP     | Done   | E1-S10       |                                                                                      |
| E1-S12   | As a User, I want a "Forgot Password" functionality, so I can reset my password if I forget it.                                                                                                      | - "Forgot Password" link on login page.\<br\>- User can enter their email address.\<br\>- If email exists, a password reset link is sent via Supabase Auth.\<br\>- Clicking the link takes user to a page to enter and confirm a new password.\<br\>- New password updates Supabase record.                                                                                                                                                                                                                                                        | Medium   | 3 SP     | Done   | E1-S7, E1-S8 |                                                                                      |
| E1-S13   | As a Developer, I want to create a comprehensive `README.md` and define initial repository guidelines, so that project setup and contribution are clear.                                             | - `README.md` created at the project root.\<br\>- README includes: project overview, links to key documents (PRD, Architecture), local development setup instructions (prerequisites, env vars, running dev server), instructions for running tests.\<br\>- README includes basic contribution guidelines: Git branching strategy (e.g., main, develop, feature/feature-name), PR process (e.g., PR template, review expectations).\<br\>- Initial `.gitignore` file is reviewed and sufficient.                                                   | High     | 2 SP     | Done   | E1-S1        | Addresses PO feedback on project setup documentation.                                |
| E1-S14   | As a Developer, I want to define and document the database schema migration strategy using Supabase tools, so that schema changes are managed systematically.                                        | - Strategy for creating and applying Supabase schema migrations (e.g., using Supabase CLI or UI-driven DDL) is documented (e.g., in `README.md` or a dedicated `docs/migrations.md`).\<br\>- Process for versioning migrations is defined.\<br\>- Process for applying migrations in different environments (local, staging, production) is outlined.                                                                                                                                                                                              | High     | 2 SP     | Done   | E1-S2, E1-S3 | Addresses PO feedback on DB migration strategy.                                      |
| E1-S15   | As a Developer, I want to set up the initial testing frameworks (Jest, React Testing Library) and core mocking infrastructure for external services, so that unit and integration testing can begin. | - Jest and React Testing Library are installed and configured as per `docs/testing-strategy.md`.\<br\>- Basic test script added to `package.json`.\<br\>- Initial mock setup for key external services (Supabase client, Gemini API, Stripe API, Resend API) is created (e.g., in `__mocks__` or test setup files) to allow for isolated unit/integration testing as outlined in `docs/testing-strategy.md`.\<br\>- Example unit test and component test are created and pass.                                                                     | Critical | 3 SP     | To Do  | E1-S1        | Addresses PO feedback on testing infra. Ref: `docs/testing-strategy.md`.             |
| E1-S16   | As a Developer, I want to set up Stripe products/prices and a basic mechanism to flag/manage subscription status in the DB, so core subscribed features can be developed.                            | - Stripe products and prices for CFI/School MVP subscriptions defined in Stripe dashboard.\<br\>- `subscriptions` table created in Supabase (linking to users/organizations) with fields like `stripe_subscription_id`, `status` (e.g., 'active', 'inactive', 'past_due'), `current_period_end`.\<br\>- Initial RLS for `subscriptions` table.\<br\>- A simple mechanism to manually update or have a very basic webhook update this status for early development of subscribed features (full webhook handling in Epic 4).                        | Critical | 3 SP     | To Do  | E1-S2, E4-S1 | Addresses PO feedback on E3/E4 dependency. Enables early dev of subscribed features. |
| E1-S17   | As a Developer, I want to establish conventions for shared UI components (using shadcn/ui) and set up basic project structure for them, so UI development is consistent.                             | - Project directory structure for shared/reusable UI components (e.g., `src/components/shared` or `src/components/ui`) is defined as per `docs/project-structure.md`.\<br\>- Conventions for creating and styling shared components (leveraging shadcn/ui and Tailwind CSS utility classes) are documented (e.g., in `coding-standards.md` or a `CONTRIBUTING.md` section).\<br\>- Basic `shadcn/ui` setup (e.g. `components.json`, theme configuration) is completed and any initial global styles are defined.                                   | High     | 2 SP     | To Do  | E1-S1        | Addresses PO feedback on shared UI component strategy.                               |
| E1-S18   | As a Developer, I want to implement a feature flag system, so that incomplete features can be safely deployed and enabled/disabled as needed.                                                        | - Feature flag library/system selected and integrated (e.g., using simple environment variables, Supabase config table, or a third-party service like LaunchDarkly/ConfigCat).\<br\>- Helper functions created to check feature flag status in both server and client components.\<br\>- Documentation on how to use feature flags in the codebase.\<br\>- At least one example feature flag implemented for demonstration.\<br\>- Admin interface or configuration file for toggling feature flags in different environments.                     | High     | 3 SP     | To Do  | E1-S1        | Enables incremental deployment of features for early testing.                        |
| E1-S19   | As a Project Team Member, I want clearly defined "Definition of Done" criteria for the project, so that quality standards are maintained consistently.                                               | - Create and document "Definition of Done" criteria that includes: code quality standards, test coverage requirements, PR review process, accessibility standards, cross-browser compatibility.\<br\>- Implement any automated tools/checks to enforce DoD (e.g., GitHub Actions, linting, test coverage).\<br\>- Create PR template that includes DoD checklist for developers.\<br\>- Document process for exceptions to DoD standards.\<br\>- Share DoD with all team members and ensure understanding.                                         | Critical | 2 SP     | Done   | E1-S1        | Ensures consistent quality standards across the project.                             |
| E1-S20   | As a Developer, I want to set up basic analytics tracking, so that we can gather user behavior data from day one.                                                                                    | - Select and integrate an analytics solution (PostHog).\<br\>- Implement page view tracking for key pages (landing, signup, login, dashboard).\<br\>- Configure event tracking for critical user actions (signup, login, role selection, subscription view).\<br\>- Ensure analytics respects user privacy and complies with regulations.\<br\>- Create a simple dashboard or reporting mechanism for tracking key metrics.                                                                                                                        | Medium   | 2 SP     | To Do  | E1-S10       | Provides early insights into user behavior to inform product decisions.              |

**Out of Scope for this Epic:**

- Detailed dashboard implementations (placeholders are fine).
- Subscription processing.
- Any FAA test processing functionality.
- Advanced profile settings beyond basic information.

**Assumptions:**

- Supabase is the chosen BaaS for authentication and database.
- Supabase Auth will handle authentication emails (verification, password reset).
- Resend is reserved for non-authentication communications only.
- UI/UX mockups/guidelines for landing page and auth forms will be available.

**Risks:**

- Complexity in setting up role-based access correctly in Supabase.
- Delays if UI/UX guidelines are not ready.

**Dependencies:**

- UI/UX designs for landing page and auth screens.
- Access to Supabase and Resend accounts/API keys.

**Metrics for Success:**

- Users can successfully sign up, verify email, complete onboarding, log in, and manage basic profile information.
- Landing page effectively communicates value proposition.
- Core infrastructure is stable and ready for feature development.
- Feature flags allow for controlled rollout of new functionality.
- Analytics provide insights into user behavior and conversion paths.
- Definition of Done ensures consistent quality across deliverables.
