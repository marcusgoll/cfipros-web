# Epic 5: Initial Model Context Protocol (MCP) API & Deployment Prep

**Epic Number:** 5
**Title:** Initial Model Context Protocol (MCP) API & Deployment Prep
**Status:** To Do
**Priority:** Medium
**Product Owner:** TBD
**Assigned Team:** TBD
**Sprint Allocation:** Sprint 6-7 (Estimate)

**Goal:** Define and implement the V1 read-only API for the Model Context Protocol (MCP) to allow authenticated external AI agents to retrieve FAA Airman Certification Standards (ACS) code definitions. Additionally, prepare the entire application for initial deployment on Vercel, including final testing, documentation, and go-live procedures.

**Description:**
This epic has two main components. First, it initiates the vision for the Model Context Protocol (MCP) by developing a V1 read-only API. For MVP, this API will allow authenticated external AI agents to look up details (description, area, task, etc.) for specific FAA ACS codes directly from the CFIPros internal ACS database. This initial version will not involve any user data or PII. Second, this epic covers all final preparations for deploying the CFIPros MVP to production on Vercel. This includes comprehensive end-to-end testing, setting up production environments, implementing basic monitoring and logging, ensuring compliance aspects like a cookie consent banner are in place, and creating initial API documentation.

**User Stories:**

| Story ID | User Story                                                                                                                                                                 | Acceptance Criteria                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Priority | Estimate | Status | Dependencies                            | Notes                                                                                                                 |
| :------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------- | :------- | :----- | :-------------------------------------- | :-------------------------------------------------------------------------------------------------------------------- |
| E5-S1    | As a Developer, I want to define the schema and scope for the V1 Model Context Protocol (MCP) API, so that external AI agents can retrieve details for specific ACS codes. | - MCP API V1 scope finalized: read-only access to ACS code definitions (ID, description, area, task, sub_task, knowledge_area, exam_type) from the internal `acs_codes` database.<br/>- Data schema for API responses defined (JSON format, providing details for one or more requested ACS codes).<br/>- No PII or user-aggregated data exposed through this V1 API.<br/>- Focus on providing direct ACS code information for external AI agent consumption.                                                    | Medium   | 2 SP     | To Do  | E2-S3 (ACS DB)                          | Scope revised to ACS code lookup, not aggregated user data.                                                           |
| E5-S2    | As a Developer, I want to implement secure API endpoint(s) for the V1 MCP API, so that authenticated external systems can access the ACS code data.                        | - Next.js API route(s) created for MCP V1 (e.g., `/api/mcp/v1/acs-codes/lookup`).<br/>- Authentication mechanism implemented using API keys (issued manually for MVP, stored securely as hashes). API key sent in request header (e.g., `X-MCP-API-Key`).<br/>- Authorization ensures only valid, active API keys can access the endpoint.<br/>- Endpoint adheres to RESTful principles (e.g., GET for lookup).<br/>- Endpoint can accept multiple ACS code IDs in a single request (e.g., via query parameter). | Medium   | 3 SP     | To Do  | E5-S1, Data Models (mcp_api_keys table) | Manual issuance of API keys acceptable for MVP.                                                                       |
| E5-S3    | As a Developer, I want to implement backend logic to query and serve ACS code data for the MCP API.                                                                        | - Backend functions to retrieve ACS code details from the `acs_codes` table in Supabase based on provided ACS code ID(s).<br/>- No aggregation or anonymization of user data is required for this V1 MCP API.<br/>- Queries optimized for direct lookup of one or more ACS codes by their ID(s).<br/>- Handles requests for multiple comma-separated ACS code IDs passed via query parameter.<br/>- Returns data in the defined JSON schema, including an errors array for any requested IDs not found.          | Medium   | 3 SP     | To Do  | E5-S1, E2-S3 (ACS DB)                   | Focus on efficient lookup from the `acs_codes` table.                                                                 |
| E5-S4    | As a Developer, I want to create initial documentation for the V1 MCP API, so that potential integrators can understand how to use it.                                     | - Basic API documentation created (as part of `docs/api-reference.md`).<br/>- Describes the ACS code lookup endpoint, request parameters (how to send code IDs, API key header), response format for ACS code data, and error handling.<br/>- Includes example requests and responses for looking up ACS codes.                                                                                                                                                                                                  | Low      | 1 SP     | To Do  | E5-S2, E5-S3                            | Aligned with the revised MCP API scope.                                                                               |
| E5-S5    | As a Developer, I want to set up and configure the production environment on Vercel and Supabase, so the application is ready for deployment.                              | - Production project/environment created in Vercel.<br/>- Production database instance configured in Supabase (if different from dev/staging, e.g., capacity, backups).\<br/>- All environment variables (API keys for Stripe, Resend, Gemini, Supabase prod keys) securely configured in Vercel for the production environment.\<br/>- Custom domain configured for Vercel production deployment.                                                                                                               | Critical | 3 SP     | To Do  | All previous epics                      |                                                                                                                       |
| E5-S6    | As a Developer, I want to implement a cookie consent banner, so that the application complies with common data privacy principles.                                         | - Standard cookie consent banner implemented (e.g., using a lightweight library or custom component).\<br/>- Allows users to accept/reject non-essential cookies (for MVP, mainly session cookies from Supabase and potentially Vercel analytics).\<br/>- Links to Privacy Policy page (content for policy page is separate).                                                                                                                                                                                    | Medium   | 2 SP     | To Do  | E1-S10                                  | Ensure it meets basic GDPR/CCPA style requirements if targeting users in those regions.                               |
| E5-S7    | As a QA/Developer, I want to perform comprehensive End-to-End (E2E) testing of all user flows and features, so that the MVP is stable and reliable.                        | - Test plan executed covering all critical user stories from Epics 1-4.\<br/>- Includes testing signup, login, FAA test processing, PDF generation, student-CFI linking, subscription flows, and basic analytics.\<br/>- Testing across major supported browsers (Chrome, Firefox, Safari, Edge).\<br/>- Issues logged and prioritized for fixing before launch.                                                                                                                                                 | Critical | 5 SP     | To Do  | All previous epics                      | Can use automated E2E testing tools (e.g., Playwright, Cypress) for key flows if time permits, otherwise manual E2E.  |
| E5-S8    | As a Product Owner/User, I want to conduct User Acceptance Testing (UAT) with a small group of target users, so we can get feedback before full launch.                    | - UAT plan prepared with specific scenarios for target users (Students, CFIs) to test.\<br/>- UAT session(s) conducted with a diverse small group of beta testers.\<br/>- Feedback collected, analyzed, and critical issues addressed.\<br/>- Final sign-off from Product Owner based on UAT results.                                                                                                                                                                                                            | High     | 4 SP     | To Do  | E5-S7                                   | UAT ideally on a staging environment identical to production.                                                         |
| E5-S9    | As a Developer, I want to prepare a final deployment checklist and execute the production deployment, so that CFIPros MVP goes live.                                       | - Deployment checklist created (e.g., final code merge, environment variable check, DB migration check, smoke tests post-deployment).\<br/>- Production branch deployed to Vercel.\<br/>- Post-deployment smoke tests performed on the live environment to ensure all critical functions are working.                                                                                                                                                                                                            | Critical | 2 SP     | To Do  | E5-S5, E5-S7, E5-S8                     |                                                                                                                       |
| E5-S10   | As a Developer, I want to set up basic logging and monitoring for the production application, so we can track errors and performance.                                      | - Vercel's built-in logging and analytics utilized.\<br\>- Supabase logs monitored for database errors/performance issues.\<br\>- Frontend error tracking (e.g., Sentry free tier) implemented if possible for MVP to catch client-side errors.\<br\>- Key health metrics identified for monitoring (e.g., API error rates, page load times).                                                                                                                                                                    | Medium   | 2 SP     | To Do  | E5-S9                                   | Keep it simple for MVP.                                                                                               |
| E5-S11   | As a Developer, I want to document the deployment rollback procedures, leveraging Vercel features, so that we can quickly revert faulty deployments.                       | - Document Vercel's native rollback capabilities (e.g., instantly reverting to a previous deployment via Vercel dashboard/CLI).\<br\>- Outline any manual verification steps post-rollback.\<br\>- Document any considerations for database state if a rollback occurs (though migrations should be designed to be reversible or managed carefully). This information can be part of deployment runbooks or `docs/deployment.md`.                                                                                | Medium   | 1 SP     | To Do  | E5-S5                                   | Addresses PO feedback on rollback procedures.                                                                         |
| E5-S12   | As a QA/Developer, I want to conduct targeted performance testing for critical user flows and the FAA test extraction tool, so that NFRs are met.                          | - Performance tests executed for: FAA Knowledge Test Extraction Tool (target <10s as per `testing-strategy.md` and PRD NFRs), core API response times under typical load, key page load times.\<br\>- Testing methodology defined (e.g., using Playwright for timing user interactions, or simple load testing tools for API endpoints if feasible for MVP).\<br\>- Results compared against NFRs from `docs/prd.md`. Deviations logged and addressed.                                                           | High     | 3 SP     | To Do  | E2, E5-S7                               | Addresses PO feedback on explicit performance testing stories. Ref: `docs/prd.md` (NFRs), `docs/testing-strategy.md`. |
| E5-S13   | As a Developer team, I want to conduct a final review and documentation of any identified technical debt before MVP launch, so that it can be prioritized post-MVP.        | - Brief review session held to identify any significant technical debt accumulated.\<br\>- Key items documented with potential impact and remediation ideas (e.g., in a `docs/technical-debt.md` or as issues in a backlog).\<br\>- No requirement to fix all tech debt for MVP, only to identify and document it.                                                                                                                                                                                               | Low      | 1 SP     | To Do  | E5-S9                                   | Addresses PO feedback on technical debt tracking.                                                                     |
| E5-S14   | As a Developer, I want to implement a simple user feedback mechanism (e.g., a "Feedback" link), so that we can collect insights from early users post-launch.              | - A "Feedback" link or button added to a prominent location (e.g., site footer or user dashboard).\<br\>- Link directs to a simple solution (e.g., a `mailto:` link to a support email, or a pre-built survey form like Google Forms/Tally.so if external tools are permitted and easy to set up).\<br\>- This supports KPI for User Satisfaction Score data collection.                                                                                                                                         | Medium   | 1 SP     | To Do  | E1-S11, E5-S9                           | Addresses PO feedback on user feedback mechanism.                                                                     |

**Out of Scope for this Epic:**

- Advanced MCP API features (write access, complex querying beyond ACS code lookup, user-specific data).
- Sophisticated admin dashboard for managing MCP API keys or monitoring API usage (manual process for MVP).
- Extensive, legally vetted Privacy Policy and Terms of Service documents (placeholders with key points are fine, but legal review is external).
- Automated E2E test suite if not feasible within MVP timeline (manual E2E is minimum).

**Assumptions:**

- Vercel and Supabase are suitable for production deployment and scaling for MVP load.
- The structure of ACS code data to be exposed via MCP API V1 is clear (as defined in `data-models.md`).
- Manual issuance of API keys for MCP API is acceptable for MVP.

**Risks:**

- Defining a V1 MCP API for ACS code lookup that is useful and easy to integrate for external agents.
- Unforeseen issues during production deployment or initial live operations.

**Dependencies:**

- Completion of all core features in Epics 1-4.
- Stable codebase passing E2E tests.
- Production environment configurations for Vercel, Supabase, Stripe, Resend, Gemini.
- UI/UX elements like cookie banner design.
- Finalized `acs_codes` table schema and data.

**Metrics for Success:**

- Successful deployment of CFIPros MVP to the production environment on Vercel.
- All critical functionalities working as expected in the live environment.
- V1 MCP API (ACS code lookup) is operational and documented.
- Positive initial feedback from UAT and early production users.
- Basic monitoring and logging are in place to track application health.
